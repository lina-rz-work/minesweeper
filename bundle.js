(()=>{"use strict";const e=class{constructor(){this.modal=document.querySelector(".modal"),this.setupEventListeners()}setupEventListeners(){this.setupCloseBehavior()}setupCloseBehavior(){this.modal.addEventListener("click",(e=>{const t=e.target;if(t.classList.contains("modal")){t.classList.remove("show");const e=t.querySelector(".show");(null==e?void 0:e.classList.contains("modal_result_container"))&&this.clearResultContainer(),(null==e?void 0:e.classList.contains("modal_rules_container"))&&this.closeRulesContainer()}}))}clearResultContainer(){const e=document.querySelector(".modal_result_container");e.classList.remove("show"),setTimeout((()=>{e.innerHTML=""}),200)}closeRulesContainer(){document.querySelector(".modal_rules_container").classList.remove("show")}},t=class{constructor(){this.rulesItem=document.querySelector(".rules_container"),this.setupEventListener()}setupEventListener(){this.rulesItem.addEventListener("click",(()=>{const e=document.querySelector(".modal"),t=document.querySelector(".modal_rules_container");e.classList.add("show"),t.classList.add("show")}))}},s=class{constructor(){this.setupEventListeners()}setupEventListeners(){this.addModeItemBehavior(),this.addModesBehavior()}addModeItemBehavior(){const e=document.querySelector(".mode_container");e.addEventListener("click",(()=>{e.classList.toggle("clicked"),e.classList.contains("clicked")||(e.classList.add("unclicked"),e.addEventListener("animationend",(()=>{e.classList.remove("unclicked")}))),this.closeHintItem(),this.clearSelectionMessage()}))}closeHintItem(){const e=document.querySelector(".hint_container");e.classList.contains("clicked")&&(e.classList.remove("clicked"),e.classList.add("unclicked"),e.addEventListener("animationend",(()=>{e.classList.remove("unclicked")})))}clearSelectionMessage(){document.querySelector(".select_option_message").innerHTML=""}addModesBehavior(){const e=document.querySelector(".mode_title"),t=document.querySelector(".mode_list");[...t.querySelectorAll("li")].forEach((s=>{s.addEventListener("click",(()=>{const i=s.getAttribute("data-mode");t.setAttribute("data-selected-mode",i),e.innerHTML=s.innerHTML}))}))}},i=class{constructor(){this.setupEventListeners()}setupEventListeners(){this.addHintItemBehavior(),this.addHintsBehavior()}addHintItemBehavior(){const e=document.querySelector(".hint_container");e.addEventListener("click",(()=>{e.classList.toggle("clicked"),e.classList.contains("clicked")||(e.classList.add("unclicked"),e.addEventListener("animationend",(()=>{e.classList.remove("unclicked")}))),this.clearSelectionMessage()}))}clearSelectionMessage(){document.querySelector(".select_option_message").innerHTML=""}addHintsBehavior(){const e=document.querySelector(".hint_title"),t=document.querySelector(".hint_list");[...t.querySelectorAll("li")].forEach((s=>{s.addEventListener("click",(()=>{const i=s.getAttribute("data-hint");t.setAttribute("data-selected-hint",i),e.innerHTML=s.innerHTML}))}))}},a=class{factoryMethod(){const e=document.createElement("div");return e.classList.add("win_result"),e.append(this.createHeader()),e.append(this.createWingImage("right_wing")),e.append(this.createWingImage("left_wing")),e.append(this.createResultMessage()),e.append(this.createGameTime()),e}createHeader(){const e=document.createElement("h3");return e.textContent="You win!",e}createWingImage(e){const t=document.createElement("img");return t.src="./assets/img/Wing.png",t.classList.add(e),t}createResultMessage(){const e=document.createElement("div");return e.classList.add("win_result_message"),e.innerHTML="Great job! It's now a safe zone thanks to your skills!",e}createGameTime(){const e=document.createElement("div"),t=document.createElement("div"),s=document.createElement("div"),i=document.querySelector(".time");return t.textContent="You completed in: ",s.innerHTML=null==i?void 0:i.innerHTML,e.classList.add("game_time"),t.classList.add("game_time_message"),s.classList.add("spent_time"),e.append(t),e.append(s),e}},r=class{factoryMethod(){const e=document.createElement("div");return e.classList.add("lose_result"),e.append(this.createHeader()),e.append(this.createResultMessage()),e.append(this.createGameTime()),e}createHeader(){const e=document.createElement("h3");return e.textContent="You lose!",e}createResultMessage(){const e=document.createElement("div");return e.classList.add("lose_result_message"),e.innerHTML="Oops! Mines detected, <br> but keep your spirits up! <br> Give it another shot. Good luck!",e}createGameTime(){const e=document.createElement("div"),t=document.createElement("div"),s=document.createElement("div"),i=document.querySelector(".time");return t.textContent="You completed in: ",s.innerHTML=null==i?void 0:i.innerHTML,e.classList.add("game_time"),t.classList.add("game_time_message"),s.classList.add("spent_time"),e.append(t),e.append(s),e}},l=class{constructor(){this.timer=document.querySelector(".time"),this.start=null,this.distance=0,this.descriptor=null}startTimer(){this.start=Date.now(),this.descriptor=setInterval((()=>{if(!this.start)return;let e=Date.now()-this.start+this.distance,t=Math.floor(e/1e3);this.draw(t)}),1e3)}stopTimer(){this.clearTimer(),this.start&&(this.distance+=Date.now()-this.start)}clearTimer(){this.descriptor&&(clearInterval(this.descriptor),this.descriptor=null)}draw(e){const t=new Date(0,0,0,0,0,e);let s=t.getHours().toString(),i=t.getMinutes().toString(),a=t.getSeconds().toString();Number(i)<10&&(i=`0${i}`),Number(a)<10&&(a=`0${a}`),this.timer.innerHTML=`${i}:${a}`,Number(i)>=60&&(Number(s)<10&&(s=`0${s}`),this.timer.innerHTML=`${s}:${i}:${a}`,this.timer.style.paddingLeft="10px")}};class n{constructor(){this.timerOn=!1,this.leftClick=e=>{const t=e.target.closest(".cell");if(!t)return;const s=t.firstElementChild.getAttribute("data-key");if(!s)return;this.timerOn||this.startTimer();const i=this.board.gameCells.get(s);(null==i?void 0:i.hasFlag)||(null==i||i.clickCell(),this.updateFlagIndicator())},this.rightClick=e=>{e.preventDefault();const t=e.target.closest(".cell");if(!t)return;const s=t.firstElementChild.getAttribute("data-key");if(!s)return;const i=this.board.gameCells.get(s);(null==i?void 0:i.isOpen)||(null==i||i.toggleFlag(),this.updateFlagIndicator()),this.timerOn||this.startTimer()},this.board=new g(0,0,0),this.timer=new l}static getInstance(){return n.instance||(n.instance=new n),n.instance}addClickHandler(e,t){this.board=e,this.timer=t;const s=document.querySelector(".game_board");s.addEventListener("click",this.leftClick),s.addEventListener("contextmenu",this.rightClick)}removeClickHandler(){const e=document.querySelector(".game_board");e.removeEventListener("click",this.leftClick),e.removeEventListener("contextmenu",this.rightClick),this.timerOn&&this.stopTimer()}stopTimer(){this.timer.stopTimer(),this.timerOn=!1}startTimer(){this.timer.startTimer(),this.timerOn=!0}updateFlagIndicator(){document.querySelector(".flag_number").innerHTML=""+(this.board.stats.mines-this.board.stats.flags)}}const o=n,c=function(e){const t=document.querySelector(".modal"),s=document.querySelector(".modal_result_container");null==s||s.append(e.factoryMethod()),e instanceof a&&setTimeout((()=>{t.classList.add("show"),s.classList.add("show")}),2300),e instanceof r&&setTimeout((()=>{t.classList.add("show"),s.classList.add("show")}),300),Array.from(document.querySelectorAll(".cell")).forEach((e=>{e.classList.add("unhovered")})),document.querySelector(".eye_button").disabled=!0,o.getInstance().removeClickHandler()},d=function(e){const t=e.mines,s=e.rows*e.cols;e.openedCells===s-t&&(Array.from(document.querySelectorAll(".mine")).forEach((e=>{e.querySelector(".flag_svg").classList.add("dissolve_flag_svg")})),c(new a))},h=class{constructor(e,t){this.hasFlag=!1,this.isOpen=!1,this.cell=document.createElement("div"),this.board=e,this.index=t,this.row=0,this.col=0}create(){this.cell.classList.add("number"),this.assignCoordinates(),this.createNumElem(),this.createFlagImg()}assignCoordinates(){this.row=Math.floor(this.index/this.board.stats.cols)+1,this.col=this.index%this.board.stats.cols+1}createNumElem(){if(this.cell.innerHTML)return;const e=this.minesAround(),t=document.createElement("span");t.style.visibility="hidden",t.innerHTML=`${e}`,t.style.color="rgb(80 65 43)",this.cell.append(t)}minesAround(){let e=0;for(let t=this.row-1;t<=this.row+1;t++)for(let s=this.col-1;s<=this.col+1;s++){const i=(t-1)*this.board.stats.cols+(s-1);this.board.gameCells.get(`mine_${i}`)&&t>0&&t<=this.board.stats.rows&&s>0&&s<=this.board.stats.cols&&(e+=1)}return e}clickCell(){this.hasFlag&&this.removeFlag(),this.isOpen||(this.cell.firstChild.style.visibility="visible",this.cell.style.backgroundColor="rgb(224 224 224)",this.isOpen=!0,++this.board.stats.openedCells,d(this.board.stats))}createFlagImg(){const e=document.createElement("img");e.src="./assets/img/flag-2-svgrepo-com.svg",e.style.visibility="hidden",e.classList.add("flag_svg"),this.cell.append(e)}toggleFlag(){const e=this.cell.querySelector(".flag_svg");"hidden"==e.style.visibility&&this.board.stats.flags<this.board.stats.mines?this.addFlag():"visible"==e.style.visibility&&this.removeFlag()}addFlag(){this.cell.querySelector(".flag_svg").style.visibility="visible",this.board.stats.flags++,this.hasFlag=!0}removeFlag(){this.cell.querySelector(".flag_svg").style.visibility="hidden",this.board.stats.flags--,this.hasFlag=!1}},m=class{constructor(e,t){this.hasFlag=!1,this.isOpen=!1,this.cell=document.createElement("div"),this.board=e,this.index=t,this.row=0,this.col=0}create(){this.cell.classList.add("mine"),this.assignCoordinates(),this.createMineImg(),this.createFlagImg(),this.createCrossImg()}assignCoordinates(){this.row=Math.floor(this.index/this.board.stats.cols)+1,this.col=this.index%this.board.stats.cols+1}createMineImg(){const e=document.createElement("img");e.src="./assets/img/bomb-svgrepo-com.svg",e.style.visibility="hidden",e.classList.add("mine_svg"),this.cell.append(e)}surroundWithNumbers(){for(let e=this.row-1;e<=this.row+1;e++)for(let t=this.col-1;t<=this.col+1;t++){const s=(e-1)*this.board.stats.cols+(t-1);if(!this.board.gameCells.get(`mine_${s}`)&&!this.board.gameCells.get(`number_${s}`)&&e>0&&e<=this.board.stats.rows&&t>0&&t<=this.board.stats.cols){const e=new h(this.board,s);e.create();const t=`number_${s}`;e.cell.setAttribute("data-key",t),this.board.gameBoard[s]=e,this.board.gameCells.set(t,e)}}}clickCell(){const e=this.cell.querySelector(".mine_svg");e.src="./assets/img/bomb-svgrepo-com-red.svg",e.addEventListener("load",(()=>{this.board.mines.forEach((e=>{e.cell.style.backgroundColor="rgb(224 224 224)",e.hasFlag||(e.cell.querySelector(".mine_svg").style.visibility="visible",this.isOpen=!0)})),c(new r)}))}createFlagImg(){const e=document.createElement("img");e.src="./assets/img/flag-2-svgrepo-com.svg",e.style.visibility="hidden",e.classList.add("flag_svg"),this.cell.append(e)}toggleFlag(){const e=this.cell.querySelector(".flag_svg");"hidden"==e.style.visibility&&this.board.stats.flags<this.board.stats.mines?this.addFlag():"visible"==e.style.visibility&&this.removeFlag()}addFlag(){this.cell.querySelector(".flag_svg").style.visibility="visible",this.board.stats.flags++,this.hasFlag=!0}removeFlag(){this.cell.querySelector(".flag_svg").style.visibility="hidden",this.board.stats.flags--,this.hasFlag=!1}createCrossImg(){const e=document.createElement("img");e.src="./assets/img/cross-svgrepo-com.svg",e.style.visibility="hidden",e.classList.add("cross_svg"),this.cell.append(e)}},u=class{constructor(e,t){this.hasFlag=!1,this.isOpen=!1,this.cell=document.createElement("div"),this.board=e,this.index=t,this.row=0,this.col=0}create(){this.cell.classList.add("empty_cell"),this.assignCoordinates(),this.createFlagImg()}assignCoordinates(){this.row=Math.floor(this.index/this.board.stats.cols)+1,this.col=this.index%this.board.stats.cols+1}createFlagImg(){const e=document.createElement("img");e.src="./assets/img/flag-2-svgrepo-com.svg",e.style.visibility="hidden",e.classList.add("flag_svg"),this.cell.append(e)}clickCell(){if(this.hasFlag&&this.removeFlag(),!this.isOpen){this.openEmptyCell();for(let e=this.row-1;e<=this.row+1;e++)for(let t=this.col-1;t<=this.col+1;t++){const s=(e-1)*this.board.stats.cols+(t-1);if(e>0&&e<=this.board.stats.rows&&t>0&&t<=this.board.stats.cols){const e=this.board.gameBoard[s];e instanceof m||e.isOpen||e.clickCell()}}}}openEmptyCell(){this.cell.parentElement.classList.add("unhovered"),this.cell.style.backgroundColor="rgb(224 224 224)",this.isOpen=!0,++this.board.stats.openedCells,d(this.board.stats)}toggleFlag(){const e=this.cell.querySelector(".flag_svg");"hidden"==e.style.visibility&&this.board.stats.flags<this.board.stats.mines?this.addFlag():"visible"==e.style.visibility&&this.removeFlag()}addFlag(){this.cell.querySelector(".flag_svg").style.visibility="visible",this.board.stats.flags++,this.hasFlag=!0}removeFlag(){this.cell.querySelector(".flag_svg").style.visibility="hidden",this.board.stats.flags--,this.hasFlag=!1}},g=class{constructor(e,t,s){this.stats={rows:e,cols:t,mines:s,flags:0,openedCells:0},this.mines=[],this.gameCells=new Map,this.gameBoard=[]}create(){this.createMines(),this.createNumbers(),this.createEmptyCells()}createMines(){const e=this.mineIndexes();for(let t of e){const e=new m(this,t);e.create();const s=`mine_${t}`;e.cell.setAttribute("data-key",s),this.gameBoard[t]=e,this.gameCells.set(s,e)}}mineIndexes(){const e=[],t=this.stats.rows*this.stats.cols;for(;e.length<this.stats.mines;){const s=Math.floor(Math.random()*(t-1))+1;e.includes(s)||e.push(s)}return e}createNumbers(){this.mines=Array.from(this.gameCells.values()),this.mines.forEach((e=>{e instanceof m&&e.surroundWithNumbers()}))}createEmptyCells(){const e=this.stats.rows*this.stats.cols;for(let t=0;t<e;t++){const e=this.gameCells.get(`mine_${t}`),s=this.gameCells.get(`number_${t}`);e||s||this.createEmptyCell(t)}}createEmptyCell(e){const t=new u(this,e);t.create();const s=`emptyCell_${e}`;t.cell.setAttribute("data-key",s),this.gameBoard[e]=t,this.gameCells.set(s,t)}},y=class{constructor(e){this.board=e,this.boardElement=function(e,t){const s=document.createElement("div");s.classList.add("game_board");for(let i=1;i<=e;i++){for(let e=1;e<=t;e++){const e=document.createElement("div");e.classList.add("cell"),s.append(e)}const e=document.createElement("br");s.append(e)}return s}(this.board.stats.rows,this.board.stats.cols)}create(){this.renderFlagIndicator(),this.renderGameBoard()}renderFlagIndicator(){document.querySelector(".flag_number").innerHTML=`${this.board.stats.mines}`}renderGameBoard(){document.querySelector(".board_game_container").append(this.boardElement),this.renderCells()}renderCells(){const e=Array.from(this.boardElement.querySelectorAll(".cell"));for(let t=0;t<e.length;t++)e[t].append(this.board.gameBoard[t].cell)}},v=class{constructor(){this.eyeButton=document.querySelector(".eye_button"),this.setupEventListeners()}setupEventListeners(){const e=document.querySelector(".eye_close"),t=document.querySelector(".eye_open"),s=Array.from(document.querySelectorAll(".cross_svg"));this.eyeButton.addEventListener("mousedown",(()=>{e.style.visibility="hidden",t.style.visibility="visible",s.forEach((e=>e.style.visibility="visible"))})),this.eyeButton.addEventListener("mouseup",(()=>{e.style.visibility="visible",t.style.visibility="hidden",s.forEach((e=>e.style.visibility="hidden"))})),this.eyeButton.addEventListener("mousemove",(()=>{e.style.visibility="visible",t.style.visibility="hidden",s.forEach((e=>e.style.visibility="hidden"))})),this.eyeButton.addEventListener("dragstart",(e=>{e.preventDefault()}))}},b=class{constructor(){this.newGameBtn=document.querySelector(".new_game_btn"),this.setupEventListener()}setupEventListener(){this.newGameBtn.addEventListener("click",(()=>{this.resetTimer(),this.clearBoard(),this.showHomePage()}))}resetTimer(){o.getInstance().stopTimer(),document.querySelector(".time").innerHTML="00:00"}clearBoard(){document.querySelector(".board_game_container").innerHTML=""}showHomePage(){const e=document.querySelector(".home_page"),t=document.querySelector(".game_container");e.style.display="block",t.style.display="none",document.querySelector(".greeting").classList.remove("fade_out"),[...document.querySelectorAll(".menu_block")].forEach((e=>{e.classList.remove("fade_out")}))}},p=class{create(e,t,s){const i=new g(e,t,s);i.create(),new y(i).create();const a=new l;o.getInstance().addClickHandler(i,a),new v,new b,this.showGame()}showGame(){const e=document.querySelector(".home_page"),t=document.querySelector(".game_container");e.style.display="none",t.style.display="flex"}},L=class{constructor(){this.startGameItem=document.querySelector(".start_container"),this.setupEventListener()}setupEventListener(){this.startGameItem.addEventListener("click",(()=>{(function(){const e=document.querySelector(".mode_list").getAttribute("data-selected-mode"),t=document.querySelector(".hint_list").getAttribute("data-selected-hint"),s=document.querySelector(".select_option_message");return e||t?e?!!t||(s.innerHTML="* Please select a hint mode",!1):(s.innerHTML="* Please select a game mode",!1):(s.innerHTML="* Please select a game mode and a hint mode.",!1)})()&&(this.closeMenu(),setTimeout((()=>{this.startGame()}),800))}))}closeMenu(){document.querySelector(".greeting").classList.add("fade_out"),[...document.querySelectorAll(".menu_block")].forEach((e=>{e.classList.add("fade_out")}))}startGame(){this.setHintMode(),this.setGameMode()}setHintMode(){const e=document.querySelector(".hint_list").getAttribute("data-selected-hint");"hints_on"===e&&(document.querySelector(".eye_button").disabled=!1),"hints_off"===e&&(document.querySelector(".eye_button").disabled=!0)}setGameMode(){const e=document.getElementById("playspace"),t=document.querySelector(".mode_list").getAttribute("data-selected-mode");"easy_mode"===t&&((new p).create(9,9,10),e.style.paddingTop="70px"),"medium_mode"===t&&((new p).create(15,15,40),e.style.paddingTop="60px"),"hard_mode"===t&&((new p).create(20,30,99),e.style.paddingTop="15px")}};(new class{initialize(){new e,new t,new s,new i,new L}}).initialize()})();